<div class="min-h-screen bg-ts-bg md:flex">
  <app-admin-sidebar class="hidden md:block"></app-admin-sidebar>

  <div class="flex-1 md:pl-64">
    <!-- Admin Header -->
    <div class="bg-ts-paper border-b border-ts-line shadow-sm">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <a routerLink="/admin/products" class="hover:text-ts-accent transition-colors text-ts-ink">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
          </a>
          <h1 class="text-xl font-bold text-ts-ink">
            {{ isEditMode ? 'Edit Product' : 'Quick Add Product' }}
          </h1>
        </div>
        <button (click)="logout()" class="px-4 py-2 text-sm bg-red-50 hover:bg-red-100 border border-red-200 text-red-700 rounded-xl transition-colors">
          {{ 'client.logout' | translate }}
        </button>
      </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      @if (successMessage) {
        <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-xl flex items-start gap-3">
          <svg class="w-5 h-5 text-green-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="text-sm text-green-700">{{ successMessage | translate }}</p>
        </div>
      }

      @if (errorMessage) {
        <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-start gap-3">
          <svg class="w-5 h-5 text-red-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="text-sm text-red-700">{{ errorMessage | translate }}</p>
        </div>
      }

      @if ((categories.length === 0 || models.length === 0) && !isLoading) {
        <div class="mb-6 p-4 bg-ts-accent/15 border border-ts-accent/30 rounded-xl">
          <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-ts-ink" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            <div>
              <h4 class="font-semibold text-ts-ink">Setup Required</h4>
              <p class="text-sm text-ts-ink-soft mt-1">Please create categories and models first.</p>
              <a routerLink="/admin/catalog" class="inline-flex items-center gap-2 mt-3 px-4 py-2 bg-ts-accent/20 hover:bg-ts-accent/30 text-ts-ink border border-ts-accent/30 rounded-lg transition-colors">
                Go to Catalog
              </a>
            </div>
          </div>
        </div>
      }

      <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Column -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Title & Description -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Title *</label>
                <input 
                  type="text" 
                  formControlName="title" 
                  class="w-full px-4 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink placeholder-ts-ink-soft"
                  placeholder="Product title">
                @if (productForm.get('title')?.invalid && productForm.get('title')?.touched) {
                  <p class="mt-1 text-xs text-red-600">Title is required (min 3 characters)</p>
                }
              </div>

              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Description *</label>
                <textarea 
                  formControlName="description"
                  rows="4"
                  class="w-full px-4 py-3 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink placeholder-ts-ink-soft resize-none"></textarea>
              </div>
            </div>
          </div>

          <!-- Specs -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-ts-ink mb-4">Details</h2>
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Price (USD)</label>
                <input type="number" formControlName="price" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink" placeholder="e.g. 59.00">
              </div>
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Stock</label>
                <input type="number" formControlName="stock" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink" placeholder="e.g. 100">
              </div>
            </div>
            <div class="grid sm:grid-cols-2 gap-4 mt-4">
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Category</label>
                <select formControlName="categoryId" (change)="onCategoryChange(); selectedCatalogOption = null" class="w-full px-4 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent">
                  <option value="">Select category</option>
                  @for (category of categories; track category.id) {
                    <option [value]="category.id">{{ category.name }}</option>
                  }
                </select>
                <div class="mt-2">
                  <button type="button" class="text-sm text-ts-accent underline" (click)="showNewCategoryInput = !showNewCategoryInput">
                    + New category
                  </button>
                  @if (showNewCategoryInput) {
                    <div class="flex items-center gap-2 mt-2 relative z-20">
                      <input type="text" [(ngModel)]="newCategoryName" [ngModelOptions]="{standalone: true}" placeholder="Category name" class="flex-1 px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent" />
                      <button type="button" class="px-3 py-2 bg-ts-accent text-ts-ink rounded-lg border border-ts-accent/60 hover:bg-ts-accent/90 relative z-30" (click)="createCategoryInline()">Add</button>
                    </div>
                  }
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Model</label>
                <select formControlName="modelId" (change)="onModelChange()" class="w-full px-4 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent" [attr.disabled]="!productForm.get('categoryId')?.value ? true : null">
                  <option value="">Select model</option>
                  @for (model of filteredModels.length ? filteredModels : models; track model.id) {
                    <option [value]="model.id">{{ model.name }}</option>
                  }
                </select>
                <div class="mt-2">
                  <button type="button" class="text-sm text-ts-accent underline" (click)="showNewModelInput = !showNewModelInput">
                    + New model
                  </button>
                  @if (showNewModelInput) {
                    <div class="flex items-center gap-2 mt-2 relative z-20">
                      <input type="text" [(ngModel)]="newModelName" [ngModelOptions]="{standalone: true}" placeholder="Model name" class="flex-1 px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent" />
                      <button type="button" class="px-3 py-2 bg-ts-accent text-ts-ink rounded-lg border border-ts-accent/60 hover:bg-ts-accent/90 relative z-30" (click)="createModelInline()">Add</button>
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>

          <!-- Variants -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold text-ts-ink">Variants</h2>
              <button type="button" class="px-3 py-2 text-sm bg-ts-accent/20 border border-ts-accent/30 text-ts-ink rounded-lg hover:bg-ts-accent/30 transition-colors" (click)="addVariant()">
                + Add variant
              </button>
            </div>
            <p class="text-xs text-ts-ink-soft mb-4">Create options like color or finish. Customers must choose one on the product page.</p>
            @if (!variantDrafts.length) {
              <div class="text-sm text-ts-ink-soft bg-ts-bg-soft/60 border border-ts-line rounded-lg p-4">
                No variants yet. Add one if this product has multiple options.
              </div>
            } @else {
              @for (variant of variantDrafts; track variant.tempId; let i = $index) {
                <div class="border border-ts-line rounded-xl p-4 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-semibold text-ts-ink">Variant {{ i + 1 }}</span>
                    <button type="button" class="text-xs text-red-600 hover:text-red-700" (click)="removeVariant(i)">Remove</button>
                  </div>
                  <div class="grid sm:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">Label</label>
                      <input type="text" [(ngModel)]="variant.label" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink" placeholder="e.g. Red">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">SKU</label>
                      <input type="text" [(ngModel)]="variant.sku" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink" placeholder="Optional">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">Price (USD)</label>
                      <input type="number" [(ngModel)]="variant.price" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink" placeholder="Optional">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">Stock</label>
                      <input type="number" [(ngModel)]="variant.stock" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink" placeholder="Optional">
                    </div>
                    <div class="sm:col-span-2 flex items-center gap-2">
                      <input type="checkbox" [(ngModel)]="variant.active" [ngModelOptions]="{standalone: true}" class="w-4 h-4 text-ts-accent border-ts-line rounded">
                      <span class="text-xs text-ts-ink">Active</span>
                    </div>
                  </div>

                  <div class="mt-4">
                    <label class="block text-xs font-medium text-ts-ink mb-2">Variant Image</label>
                    <input type="file" accept="image/*" (change)="onVariantImageSelected($event, variant)" class="block w-full text-xs text-ts-ink file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-semibold file:bg-ts-accent/20 file:text-ts-ink hover:file:bg-ts-accent/30">
                    @if (variant.imagePreview) {
                      <div class="mt-3 w-full md:w-56 aspect-video bg-ts-bg-soft border border-ts-line rounded-xl overflow-hidden flex items-center justify-center relative group">
                        <img [src]="variant.imagePreview" alt="Variant preview" class="w-full h-full object-cover">
                        <button type="button"
                                (click)="clearVariantImage(variant)"
                                class="absolute top-2 right-2 p-1.5 rounded-lg bg-error text-white opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-error/90">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                          </svg>
                        </button>
                      </div>
                    }
                  </div>
                </div>
              }
            }
          </div>

          <!-- Bulk Pricing -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold text-ts-ink">Bulk Pricing</h2>
              <button type="button" class="px-3 py-2 text-sm bg-ts-accent/20 border border-ts-accent/30 text-ts-ink rounded-lg hover:bg-ts-accent/30 transition-colors" (click)="addBulkPricingTier()">
                + Add tier
              </button>
            </div>
            <p class="text-xs text-ts-ink-soft mb-4">Set unit price by minimum quantity. Applied at checkout and in the cart.</p>
            @if (!bulkPricingTiers.length) {
              <div class="text-sm text-ts-ink-soft bg-ts-bg-soft/60 border border-ts-line rounded-lg p-4">
                No bulk tiers yet.
              </div>
            } @else {
              @for (tier of bulkPricingTiers; track $index; let i = $index) {
                <div class="grid sm:grid-cols-3 gap-3 items-end border border-ts-line rounded-lg p-3 mb-3">
                  <div>
                    <label class="block text-xs font-medium text-ts-ink mb-1">Min Qty</label>
                    <input type="number" [(ngModel)]="tier.minQty" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-ts-ink mb-1">Unit Price</label>
                    <input type="number" [(ngModel)]="tier.unitPrice" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink">
                  </div>
                  <div>
                    <label class="block text-xs font-medium text-ts-ink mb-1">Label (optional)</label>
                    <input type="text" [(ngModel)]="tier.label" [ngModelOptions]="{standalone: true}" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink" placeholder="e.g. 10+ discount">
                  </div>
                  <div class="sm:col-span-3 flex justify-end">
                    <button type="button" class="text-xs text-red-600 hover:text-red-700" (click)="removeBulkPricingTier(i)">Remove</button>
                  </div>
                </div>
              }
            }
          </div>

          <!-- Media -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-ts-ink mb-4">Media</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Cover Image *</label>
                <input type="file" accept="image/*" (change)="onCoverSelected($event)" class="block w-full text-sm text-ts-ink file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-ts-accent/30 file:text-ts-ink hover:file:bg-ts-accent/50">
                @if (coverPreview || productForm.get('imageUrl')?.value) {
                  <div class="mt-3 w-full md:w-56 aspect-video bg-ts-bg-soft border border-ts-line rounded-xl overflow-hidden flex items-center justify-center relative group">
                    <img [src]="coverPreview || productForm.get('imageUrl')?.value" alt="Cover preview" class="w-full h-full object-cover">
                    <button type="button" 
                            (click)="removeCoverImage()"
                            class="absolute top-2 right-2 p-1.5 rounded-lg bg-error text-white opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-error/90">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                    </button>
                  </div>
                }
              </div>

              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Product Video (Optional)</label>
                <p class="text-xs text-ts-ink-soft mb-2">Upload a video to showcase your product (MP4, WebM, or MOV, max 50MB)</p>
                <input type="file" accept="video/*" (change)="onVideoSelected($event)" class="block w-full text-sm text-ts-ink file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary/30 file:text-ts-ink hover:file:bg-primary/50">
                @if (videoPreview || productForm.get('videoUrl')?.value) {
                  <div class="mt-3 w-full md:w-96 aspect-video bg-ts-bg-soft border border-ts-line rounded-xl overflow-hidden relative group">
                    <video [src]="videoPreview || productForm.get('videoUrl')?.value" controls class="w-full h-full object-cover"></video>
                    <button type="button" 
                            (click)="removeVideo()"
                            class="absolute top-2 right-2 p-1.5 rounded-lg bg-error text-white opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-error/90">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                    </button>
                  </div>
                }
                <div class="mt-3" *ngIf="uploadingVideo">
                  <div class="w-full bg-ts-bg-soft border border-ts-line rounded-full h-2 overflow-hidden">
                    <div class="h-full bg-ts-accent transition-all duration-200" [style.width.%]="videoUploadProgress"></div>
                  </div>
                  <p class="text-xs text-ts-ink-soft mt-1">Uploading video... {{ videoUploadProgress }}%</p>
                </div>
                <p *ngIf="videoUploadComplete && !uploadingVideo" class="text-xs text-green-600 mt-2">Video uploaded</p>
              </div>

              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Gallery Images</label>
                <input type="file" accept="image/*" multiple (change)="onGallerySelected($event)" class="block w-full text-sm text-ts-ink file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-ts-accent/30 file:text-ts-ink hover:file:bg-ts-accent/50">
                @if (galleryPreviews.length) {
                  <div class="mt-3 grid grid-cols-2 sm:grid-cols-3 gap-3">
                    @for (preview of galleryPreviews; track $index; let i = $index) {
                      <div class="aspect-video bg-ts-bg-soft border border-ts-line rounded-lg overflow-hidden relative group">
                        <img [src]="preview" class="w-full h-full object-cover">
                        <button type="button" 
                                (click)="removeGalleryImage(i)"
                                class="absolute top-2 right-2 p-1.5 rounded-lg bg-error text-white opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-error/90">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                          </svg>
                        </button>
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Customization -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <div class="flex items-start justify-between gap-4 mb-4">
              <div>
                <h2 class="text-lg font-semibold text-ts-ink">Customization</h2>
                <p class="text-xs text-ts-ink-soft mt-1">Enable customer uploads and define the logo placement area.</p>
              </div>
              <label class="inline-flex items-center gap-2 text-sm text-ts-ink">
                <input type="checkbox" formControlName="customizable" class="w-4 h-4 text-ts-accent border-ts-line rounded focus:ring-ts-accent">
                Customizable
              </label>
            </div>

            @if (productForm.get('customizable')?.value) {
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-ts-ink mb-2">Base image URL (optional)</label>
                  <input
                    type="text"
                    formControlName="customizationBaseImageUrl"
                    class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink"
                    placeholder="Defaults to cover image">
                </div>

                <div>
                  <label class="block text-sm font-medium text-ts-ink mb-2">Placement (percent of base image)</label>
                  <div class="grid sm:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">X (%)</label>
                      <input type="number" min="0" max="100" formControlName="customizationX" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">Y (%)</label>
                      <input type="number" min="0" max="100" formControlName="customizationY" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">Width (%)</label>
                      <input type="number" min="1" max="100" formControlName="customizationWidth" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink">
                    </div>
                    <div>
                      <label class="block text-xs font-medium text-ts-ink mb-1">Height (%)</label>
                      <input type="number" min="1" max="100" formControlName="customizationHeight" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink">
                    </div>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-ts-ink mb-2">Rotation (degrees)</label>
                  <input type="number" formControlName="customizationRotation" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink" placeholder="0">
                </div>
              </div>
            }
          </div>

          <!-- SEO -->
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-ts-ink mb-4">SEO</h2>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">SEO Title</label>
                <input type="text" formControlName="metaTitle" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink">
              </div>
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">SEO Description</label>
                <textarea formControlName="metaDescription" rows="3" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-ts-ink mb-2">Slug</label>
                <input type="text" formControlName="slug" class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg focus:ring-2 focus:ring-ts-accent focus:border-ts-accent text-ts-ink">
              </div>
            </div>
          </div>
        </div>

        <!-- Side Column -->
        <div class="space-y-6">
          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-ts-ink mb-4">Status</h2>
            <div class="space-y-3">
              <label class="inline-flex items-center gap-3 text-ts-ink">
                <input type="radio" formControlName="status" value="draft" class="w-4 h-4 text-ts-accent border-ts-line focus:ring-ts-accent">
                Draft
              </label>
              <label class="inline-flex items-center gap-3 text-ts-ink">
                <input type="radio" formControlName="status" value="published" class="w-4 h-4 text-ts-accent border-ts-line focus:ring-ts-accent">
                Published
              </label>
            </div>
          </div>

          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-ts-ink mb-4">Collections</h2>
            @if (collections.length) {
              <div class="flex flex-col gap-2">
                @for (collection of collections; track collection.slug) {
                  <label class="inline-flex items-center gap-3 text-sm text-ts-ink cursor-pointer">
                    <input
                      type="checkbox"
                      class="w-4 h-4 text-ts-accent border-ts-line focus:ring-ts-accent rounded"
                      [checked]="isCollectionSelected(collection.slug)"
                      (change)="toggleCollection(collection)">
                    <div>
                      <div class="font-semibold">{{ collection.name }}</div>
                      @if (collection.description) {
                        <p class="text-xs text-ts-ink-soft line-clamp-2">{{ collection.description }}</p>
                      }
                    </div>
                  </label>
                }
              </div>
            } @else {
              <p class="text-sm text-ts-ink-soft">Create a collection in Admin â†’ Collections to tag this product.</p>
            }

            <div class="mt-4 border-t border-ts-line pt-4">
              <button type="button"
                      class="text-sm text-ts-accent underline font-semibold"
                      (click)="showNewCollectionInput = !showNewCollectionInput">
                {{ showNewCollectionInput ? 'Cancel new collection' : '+ New collection' }}
              </button>

              @if (showNewCollectionInput) {
                <div class="mt-4 space-y-3">
                  <div>
                    <label class="block text-sm font-medium text-ts-ink mb-1">Collection name</label>
                    <input type="text"
                           [(ngModel)]="newCollectionName"
                           (input)="onCollectionNameChange()"
                           [ngModelOptions]="{standalone: true}"
                           class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent">
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-ts-ink mb-1">Slug</label>
                    <input type="text"
                           [(ngModel)]="newCollectionSlug"
                           (input)="onCollectionSlugChange()"
                           [ngModelOptions]="{standalone: true}"
                           class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent"
                           placeholder="gifts-for-men">
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-ts-ink mb-1">Description</label>
                    <textarea rows="2"
                              [(ngModel)]="newCollectionDescription"
                              [ngModelOptions]="{standalone: true}"
                              class="w-full px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent"></textarea>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-ts-ink mb-1">Hero image</label>
                    <input type="file"
                           accept="image/*"
                           (change)="onCollectionHeroSelected($event)"
                           class="block w-full text-sm text-ts-ink file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-ts-accent/30 file:text-ts-ink hover:file:bg-ts-accent/50">
                    @if (newCollectionHeroPreview) {
                      <div class="mt-2 w-40 aspect-video rounded-lg overflow-hidden border border-ts-line bg-ts-bg-soft">
                        <img [src]="newCollectionHeroPreview" alt="Collection hero preview" class="w-full h-full object-cover">
                      </div>
                    }
                  </div>

                  <button type="button"
                          [disabled]="isCreatingCollection || !newCollectionName.trim()"
                          class="w-full inline-flex items-center justify-center px-4 py-2 bg-ts-accent text-ts-ink font-semibold rounded-lg border border-ts-accent/60 hover:bg-ts-accent/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                          (click)="createCollectionInline()">
                    @if (isCreatingCollection) {
                      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-ts-ink" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      Creating...
                    } @else {
                      Save collection
                    }
                  </button>
                </div>
              }
            </div>
          </div>

          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <h2 class="text-lg font-semibold text-ts-ink mb-4">Tags</h2>
            <div class="flex flex-wrap gap-2">
              @for (tag of tags; track tag.id) {
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-ts-line text-sm text-ts-ink cursor-pointer">
                  <input type="checkbox" [checked]="isTagSelected(tag)" (change)="toggleTag(tag)" class="w-4 h-4 text-ts-accent border-ts-line focus:ring-ts-accent">
                  {{ tag.name }}
                </label>
              }
            </div>
          </div>

          <div class="bg-ts-paper border border-ts-line rounded-xl p-6 shadow-sm">
            <div class="flex flex-col gap-3">
              <button type="submit" [disabled]="isSaving || isUploading" class="w-full inline-flex items-center justify-center px-4 py-3 bg-ts-accent text-ts-ink font-semibold rounded-lg border border-ts-accent/60 hover:bg-ts-accent/90 transition-colors disabled:opacity-60 disabled:cursor-not-allowed">
                {{ isEditMode ? 'Save Changes' : 'Create Product' }}
              </button>
              <button type="button" (click)="cancel()" class="w-full inline-flex items-center justify-center px-4 py-3 bg-ts-bg-soft text-ts-ink font-semibold rounded-lg border border-ts-line hover:bg-ts-paper transition-colors">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
