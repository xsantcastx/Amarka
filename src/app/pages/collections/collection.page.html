<section class="bg-ts-bg min-h-screen">
  <app-page-header
    [title]="title"
    [subtitle]="subtitle"
    [breadcrumbs]="breadcrumbs"
    icon="collections">
  </app-page-header>

  <div class="page-container py-8 space-y-8">
    <!-- Hero summary -->
    <div class="rounded-3xl border border-ts-line bg-white shadow-sm p-6 lg:p-8 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
      <div class="space-y-3">
        <p class="badge">Curated collection</p>
        <h2 class="text-3xl font-serif text-ts-ink leading-tight">{{ title }}</h2>
        <p class="text-ts-ink-soft">{{ subtitle }}</p>
        <div class="flex flex-wrap gap-3 text-sm text-ts-ink-soft">
          <span class="px-3 py-1 rounded-full border border-ts-line bg-ts-bg-soft">{{ filtered.length || products.length }} items</span>
          <span class="px-3 py-1 rounded-full border border-ts-line bg-ts-bg-soft">Personalised & ready to ship</span>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-3 w-full lg:w-auto">
        @if (filtered.length > 0) {
          <div class="rounded-2xl overflow-hidden border border-ts-line bg-ts-bg-soft aspect-square">
            <img [src]="filtered[0]?.imageUrl || filtered[0]?.coverImage" alt="{{filtered[0]?.name}}" class="w-full h-full object-cover" loading="lazy">
          </div>
        }
        @if (filtered.length > 1) {
          <div class="rounded-2xl overflow-hidden border border-ts-line bg-ts-bg-soft aspect-square">
            <img [src]="filtered[1]?.imageUrl || filtered[1]?.coverImage" alt="{{filtered[1]?.name}}" class="w-full h-full object-cover" loading="lazy">
          </div>
        }
      </div>
    </div>

    <!-- Controls -->
    <div class="rounded-2xl border border-ts-line bg-ts-paper shadow-sm p-4 lg:p-5 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div class="flex-1">
        <div class="relative">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
            placeholder="Search gifts..."
            class="w-full pl-10 pr-4 py-3 bg-ts-bg-soft border border-ts-line rounded-xl text-ts-ink placeholder-ts-ink-soft focus:ring-2 focus:ring-ts-accent focus:border-ts-accent">
          <svg class="w-5 h-5 text-ts-ink-soft absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M4 11a7 7 0 1114 0 7 7 0 01-14 0z"></path>
          </svg>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2">
          <label class="text-sm text-ts-ink-soft">Sort</label>
          <select [(ngModel)]="sort" (change)="applyFilters()" class="px-3 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink focus:ring-2 focus:ring-ts-accent focus:border-ts-accent">
            <option value="newest">Newest</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
          </select>
        </div>
        <button class="px-4 py-2 bg-ts-bg-soft border border-ts-line rounded-lg text-ts-ink hover:border-ts-accent" (click)="clearFilters()">Clear</button>
      </div>
    </div>

    <!-- Tags filter -->
    @if (tags.length) {
      <div class="flex flex-wrap gap-2">
        @for (tag of tags; track tag) {
          <button
            type="button"
            (click)="toggleTag(tag)"
            class="px-3 py-1.5 rounded-full border text-sm transition-all"
            [class.bg-ts-accent]="selectedTags.has(tag)"
            [class.text-ts-ink]="selectedTags.has(tag)"
            [class.border-ts-accent]="selectedTags.has(tag)"
            [class.text-ts-ink-soft]="!selectedTags.has(tag)"
            [class.border-ts-line]="!selectedTags.has(tag)">
            {{ tag }}
          </button>
        }
      </div>
    }

    <!-- Grid -->
    @if (isLoading) {
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (i of [1,2,3,4,5,6]; track i) {
          <div class="bg-ts-paper border border-ts-line rounded-2xl h-72 animate-pulse"></div>
        }
      </div>
    } @else {
      @if (filtered.length === 0) {
        <div class="bg-ts-paper border border-ts-line rounded-2xl p-10 text-center">
          <p class="text-ts-ink-soft">No products found. Try adjusting filters.</p>
        </div>
      } @else {
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          @for (product of filtered; track product.id) {
            <ts-product-card [product]="product"></ts-product-card>
          }
        </div>
      }
    }
  </div>
</section>
